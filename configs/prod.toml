# IPPAN-L2 Production Configuration Template
# 
# IMPORTANT: This is a template. Copy and customize for your deployment.
# Never commit production secrets to version control.
#
# Usage:
#   export IPPAN_L2_CONFIG=/etc/ippan-l2/config.toml
#   export L1_BASE_URL=https://core.ippan.io
#   export L1_API_KEY=your-production-api-key
#   ./fin-node
#
# All sensitive values should come from environment variables.

[node]
label = "prod-fin-node"

[l1]
# IPPAN CORE settlement endpoint
# REQUIRED: Set via L1_BASE_URL environment variable
base_url = "env:L1_BASE_URL"
# API key for authentication
# REQUIRED: Set via L1_API_KEY environment variable
api_key = "env:L1_API_KEY"
connect_timeout_ms = 3000
request_timeout_ms = 10000

[l1.retry]
max_attempts = 5
base_delay_ms = 250
max_delay_ms = 3000

[l1.endpoints]
chain_status = "env:L1_ENDPOINT_CHAIN_STATUS"
submit_batch = "env:L1_ENDPOINT_SUBMIT_BATCH"
get_inclusion = "env:L1_ENDPOINT_GET_INCLUSION"
get_finality = "env:L1_ENDPOINT_GET_FINALITY"

[server]
# HTTP bind address for health/metrics endpoints
# Use 0.0.0.0 for container deployments
bind_address = "0.0.0.0:3000"
# Enable metrics endpoint
metrics_enabled = true
# Best-effort overload protection (HTTP 503 when exceeded).
max_inflight_requests = 64

[limits]
max_body_bytes = 262144
max_string_bytes = 1024
max_tags = 32
max_tag_bytes = 48
max_batch_items = 256
max_receipt_bytes = 262144
max_json_depth = 64

[rate_limit]
enabled = true
requests_per_minute = 120
burst = 60

[pagination]
default_limit = 50
max_limit = 200

[retention]
receipts_days = 30
recon_failed_days = 7
min_receipts_keep = 1000

[pruning]
enabled = true
interval_secs = 86400

[cors]
# Default deny. Set `enabled=true` + allow_origins when running behind a trusted gateway.
enabled = false
allow_origins = []

[hubs]
# Enable FIN Hub
fin_enabled = true
# Enable DATA Hub
data_enabled = true

[storage]
# Persistent storage path
# IMPORTANT: Must be on persistent volume in containerized deployments
path = "/var/lib/ippan-l2/prod"

# fin-node storage roots (used by this repo's fin-node config loader).
# Note: `path` above is not consumed by fin-node; prefer explicit dirs below.
receipts_dir = "/var/lib/ippan-l2/prod/receipts"
fin_db_dir = "/var/lib/ippan-l2/prod/fin_db"
data_db_dir = "/var/lib/ippan-l2/prod/data_db"
policy_db_dir = "/var/lib/ippan-l2/prod/policy_db"
recon_db_dir = "/var/lib/ippan-l2/prod/recon_db"

[recon]
# Production recommendation: slower polling, bounded backoff.
enabled = true
interval_secs = 30
batch_limit = 50
max_scan = 20000
max_attempts = 200
base_delay_secs = 2
max_delay_secs = 300

[linkage]
# For strict settlement semantics, set:
# entitlement_policy = "finality_required"
entitlement_policy = "optimistic"

[logging]
# Log level: trace, debug, info, warn, error
# Use "info" or "warn" in production
level = "info"
# Output format: json for log aggregation
format = "json"

[oracle]
# Oracle daemon configuration
enabled = true
# Poll interval (production: less frequent to reduce load)
poll_interval_ms = 60000
